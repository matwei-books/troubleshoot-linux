%% tl-lokal-werkzeuge.tex
\chapter{Werkzeuge zur lokalen Fehlersuche}
\label{cha:lokal-werkzeuge}

\begin{abstractsec}
  Verschiedene Werkzeuge helfen mir lokale Probleme einzugrenzen. Hier stelle
  ich die Werkzeuge kurz vor, die ich in den nächsten drei Kapiteln zur
  Fehlersuche einsetze.
\end{abstractsec}

\begin{normaltext}
  Linux stellt mir eine Unmenge von Werkzeugen für die Fehlersuche zur
  Verfügung. Etliche davon kommen mir sowohl bei Total- oder Partialausfällen
  zu gute. Andere bei Performanceproblemen. Einige sind so nützlich, dass sie
  immer wieder bei den unterschiedlichsten Problemen zum Einsatz kommen. Da
  es mir schwerfällt, die einzelnen Werkzeuge bestimmten Kategorien
  zuzuordnen, stelle ich diese nachfolgend in alphabetischer Reihenfolge vor.
  Das erleichtert zumindest das Wiederfinden, wenn man mal eben etwas schnell
  nachschlagen möchte.
\end{normaltext}

\begin{notes}
\item hdparm
\item fuser
\item gdb
\item ifconfig
\item iproute
\item lsof
\item netstat
\item perl
\item shell
\end{notes}

\section{strace}
%\label{sec:lokal-werkzeug-strace}

%\begin{abstractsec}
%  Die Aufteilung der Umsetzung wird hier gegliedert in verschiedene Aspekte
%\end{abstractsec}
\begin{normaltext}
  Strace ist ein Werkzeug, dass ich einsetze, wenn mir das Verhalten eines
  Programmes unklar ist. Wenn ich Probleme mit Zugriffsrechten vermute, aber
  keinen Anhaltspunkt in den Fehlermeldungen oder Systemprotokollen finde.
  Wenn ich mit einem Programm noch wenig Erfahrung habe, kaum Hilfe zu meinem
  Problem im Internet finde, aber das Problem trotzdem so schnell wie möglich
  beheben will.
  In \cite{guug:uptimes:2012.1/07} führt Harald König sehr gut in die Arbeit
  mit strace ein.
  
  Strace hilft mir, wenn ich beobachten will, wie ein Programm
  mit seiner Umgebung interagiert. Es setzt dazu an der Kernelschnittstelle
  an und protokolliert alle Systemaufrufe mit den Parametern und Ergebnissen.
  Diese werden im Protokoll ähnlich den Systemaufrufen in der
  Programmiersprache C dargestellt: das Ergebnis steht hinter einem
  Gleichheitszeichen am Ende der Zeile, die Systemzeit steht vor dem
  Systemaufruf. Wenn ich mehrere Prozesse beobachte und in dieselbe Datei
  protokolliere, steht auch noch die Prozess-ID am Anfang der Zeile.

  Um die Ausgabe von strace interpretieren zu können, ist es hilfreich die
  Sektion der Handbuchseiten zu installiert zu haben. Diese befinden sich bei
  Debian-basierten Systemen im Paket manpages-dev.

  Da strace Systemaufrufe der beobachteten Prozesse protokolliert, verlangsamt
  sich deren Ablauf, was zu zusätzlichen Problemen bei der Fehlersuche führen
  kann. Dessen muss ich mir beim Einsatz von strace immer bewusst sein.

  Ich persönlich setze strace bei der Fehlersuche meist auf eine der folgenden
  Weisen ein.

  Bei Problemen mit mit Programmen, die von Hand aufgerufen werden, starte ich
  das betreffende Programm wie gewohnt, allerdings setze ich am Anfang der
  Kommandozeile strace mit einigen Optionen ein. Aus

  \begin{verbatim}
  $ make xyz
  \end{verbatim}

  wird dann

  \begin{verbatim}
  $ strace -f -o make.strace make xyz
  \end{verbatim}

  Dabei bedeuten die Optionen

  \begin{description}
    \item[-f] Strace soll auch von make gestartete Programme verfolgen.
    \item[-o make.strace] Die Ausgabe soll in die Datei make.strace
      geschrieben werden.
  \end{description}

  Bei Problemen mit bereits gestarteten Prozessen verwende ich die Option
  {\bf -p PID} um mich mit dem betreffenden Prozess zu verbinden. Alle
  weiteren Optionen verwende ich wie gehabt, auf die Angabe des Programmnamens
  und der Programmparameter kann ich verzichten.

  Schwieriger ist es, wenn ein Programm ein zweites aufruft, dieses ein
  drittes und so weiter. Wenn ich nur an einem der Programme interessiert bin
  und nicht genau weiss, von welchem Prozess beziehungsweise Programm dieses
  gestartet wird, helfe ich mir mit einem Trick. Ich benenne das eigentliche
  Programm um und ersetze es durch ein Skript, welche alle mich
  interessierenden Werte wie zum Beispiel die Aufrufparameter, die Umgebung,
  die UID/GID, die Standardeingabe und/oder -ausgabe protokolliert und
  schließlich das Originalprogramm via strace aufruft.
  Damit bekomme ich meist genügend Informationen, um das Problem zu lösen.
  Natürlich darf ich am Ende nicht vergessen, das Skript wieder durch das
  Originalprogramm zu ersetzen.
\end{normaltext}

\begin{notes}
\item Was für eine Kernelschnittstelle nutzt strace?
\end{notes}

%\subsection{Seiteneffekte}
%\label{sec:seiteneffekte}

%\subsection{Einschränkung der Umsetzung}
%\label{sec:einschr-der-umsetz}

%\section{Schnittstellen nach außen}
%\label{sec:schn-nach-au3en}

%\subsection{Schnittstelle zu A}
%\label{sec:schnittstelle-zu}

%\subsection{Schnittstelle zu B}
%\label{sec:schnittstelle-zu-b}

%\begin{notes}
%\item Syntax
%\item Semantik
%\end{notes}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "arbeit-hauptdatei"
%%% End: 
%%% vim: set sw=2 ts=2 tw=78 et si:
