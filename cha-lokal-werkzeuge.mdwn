
## hdparm {#sec-lokal-werkzeuge-hdparm}

Mit hdparm kann ich von der Kommandozeile aus Einfluß nehmen auf die
Schnittstelle zur Festplatte des Rechners. Ich verwende das Programm zum
Feintuning der Festplattenzugriffe aber auch zum Verifizieren und Beheben
von Plattenfehlern. Es arbeitet mit der Kernelschnittstelle des SATA-, PATA-
und SAS-Subsystems zusammen. Auch bei manchen USB-Festplatten kann ich
Parameter mit hdparm verändern. Für einige der Optionen benötige ich eine
aktuelle Kernelversion.

Allgemein sieht der Aufruf von hdparm wie folgt aus:

    hdparm [optionen] [geraet ..]

Es gibt Optionen, mit denen ich Parameter sowohl abfragen als auch setzen
kann (get/set). Bei diesen Optionen gilt, dass sie ohne weiteres Argument
den Parameter abfragen und mit zusätzlichem Argument den Wert entsprechend
setzen.

Rufe ich hdparm ganz ohne Parameter auf, verhält es sich,
als hätte ich die Optionen `-acdgkmur` angegeben.

In der Datei `/etc/hdparm.conf` kann ich die Default-Konfiguration für
hdparm systemweit hinterlegen.

Nachfolgend beschreibe ich die, aus meiner Sicht, wichtigsten Optionen.
Weitere Informationen gibt es, wie fast immer, in den Handbuchseiten.

*-a*
: (get/set) Anzahl der Sektoren für das Vorauslesen (read-ahead)
  im Dateisystem. Damit verbessert sich die Performance beim sequentiellen
  Lesen großer Dateien. Es gibt noch eine, davon separate,
  Read-Ahead-Funktion der Festplatte, diese Funktion unterstützt.

*-A*
: (get/set) Ein- oder Ausschalten der Vorauslesefunktion der Festplatte.
  Mit `-A0` wird es ausgeschaltet, mit `-A1`  eingeschaltet.

*-B*
: (get/set) Einstellen Advanced Power Management (APM)
  Eigenschaften der Platte, soweit diese das unterstützt. Gültig sind
  Werte von 1 (meiste Energieeinsparung) bis 254 (höchste
  I/O-Performance), mit dem Wert 255 wird es ganz abgeschaltet. Werte von
  1-127 erlauben einen Spin-Down der Festplatte, Werte von 128-254
  erlauben das nicht.

*-c*
: (get/set) 32-Bit-Support für (E)IDE ein- oder ausschalten.
  Mit 0 wird dieser Ausgeschaltet, 1 schaltet ihn ein und 3 schaltet den
  32-bit-Support mit speziellem Sync.

  Es geht hierbei um den Transfer via PCI oder VLB zum Hostadapter. Das
  Kabel zur Festplatte hat immer 16 Bit.

*--fibmap dateiname*
: Gibt eien Liste von Blockextents
  (Sektorbereichen), den die Datei auf der Platte belegt.

  Damit kann ich mir die Fragmentierung einer Datei auf der Platte
  ansehen, oder die Blöcke für Fehlertests bestimmen.

  Wenn diese Option verwendet wird, muss sie die einzige sein.

*-g*
: Zeigt die Laufwerksgeometrie (Zylinder, Köpfe, Sektoren), die
  Größe des Gerätes in Sektoren und den Startoffset von Beginn der Platte.

*-i*
: Zeigt Identifizierungsinformationen, die die Kerneltreiber
  während des Systemstarts und der Konfiguration gesammelt haben.

*-I*
: Zeigt die Identifizierungsinformationen, die das Laufwerk liefert.

*-m*
: (get/set) Die Anzahl der Sektoren für multiple Sektor I/O. Mit
  dem Wert 0 wird das abgeschaltet. Die meisten IDE-Festplatten erlauben
  die Übertragung von mehreren Sektoren pro Interrupt. Damit läßt sich der
  System Overhead für Disk I/O um typisch 30 bis 50 Prozent reduzieren. Es
  kann allerdings in seltenen Fällen zu massiven Dateisystemfehlern
  führen.

*--read-sector sektornummer*
: Liest den angegebenen Sektor und
  schreibt den Inhalt in Hex-Darstellung zum Standardausgang. Die
  Sektornummer muss als Dezimalzahl angegeben werden. Hdparm führt einen
  Low-Level-Read für diesen Sektor  aus. Damit kann diese Funktion als
  definitiver Test, ob ein Sektor schlecht ist, genommen werden. Um den
  Sektor durch die Platte ersetzen zu lassen, kann man die Option
  `--write-sector` verwenden.

*-t*
: Nimmt die Zeit von Lesezugriffen für Benchmarks und
  Vergleichsmessungen. Um brauchbare Werte zu erhalten, muss man diese
  Funktion mindestens zwei mal bei einem ansonsten inaktiven System (keine
  anderen aktiven Prozesse) und genügend freiem Hauptspeicher ausführen. 
  Diese Funktion zeigt, wie schnell Daten ohne den Overhead des
  Dateisystems gelesen werden können.

*-T*
: Nimmt die Zeit von Cache-Read-Zugriffen. Auch diese Funktion
  sollte mindestens zwei mal bei ansonsten inaktivem System wiederholt
  werden. Das zeigt den Durchsatz von Prozessor, Cache und RAM.

*--write-sector sektornummer*
: Schreibt Nullen in den Sektor. **Sehr gefährlich!** Irrt man
  sich in der Sektornummer, werden möglicherweise vitale Informationen des
  Dateisystems überschrieben. Die Sektornummer wird als Dezimalzahl
  angegeben.
  Diese Funktion kann zum Anstoßen der automatischen
  Reparatur des Sektors durch die Festplatte verwendet werden.
  Sinnvollerweise vergewissert man sich vorher mit der Option
  `--read-sector`, das man es wirklich mit einem defekten Sektor zu
  tun hat.

*-W*
: (get/set) Zeigt beziehungsweise modifiziert das Write Caching
  des IDE/SATA Laufwerks. 1 bedeutet, dass es eingeschaltet ist.

*-z*
: Zwingt den Kernel, die Partitionstabelle neu zu lesen.

In der Datei /etc/hdparm.conf kann die Default-Konfiguration für hdparm
hinterlegt werden. Diese Datei ist gut kommentiert, so dass ich mir weitere
Erläuterungen hier spare.

## Notizen

*   Wie installiere ich Software?

*   Was für eine Kernelschnittstelle nutzt strace?

*   Strace-Skript: Datum, Kommandozeile, Umgebung, Benutzer,
    Standardeingabe, Strace-Ausgabe

*   Diskussion: wann ltrace, wann strace

*   Was bedeutet aktive / inactive bei Memory? (vmstat)
